KittingFlow (Local Edition)
===========================

軽量なピッキング支援ツールです。React + Vite で構築され、ブラウザ内の IndexedDB（Dexie）にデータを保持します。部品・レシピ・在庫進捗を Excel 風に直接編集しながら、ピッキング作業や CSV/Gist 連携を行えます。

主な機能
--------

- **ピッキング画面**: 製品テンプレート単位で部品を順に表示し、在庫を自動的に減算。
- **部品一覧（Excel風編集）**: セル入力で部品ID・名称・在庫・画像URLを編集。Enter/矢印キーでセル移動。ID変更時は紐付くレシピも同時更新。
- **レシピ一覧（Excel風編集）**: 製品ID/名称、部品ID/名称、必要数を直接編集。部品IDを入力すると部品名を自動参照。
- **必要数量サマリ**: 複数製品を選択して累積必要数・不足数を算出。直近の選択と結果は localStorage に保持。
- **進捗管理**: 製品ごとの現在位置を一覧し、リセット操作が可能。
- **CSV / GitHub Gist 連携**: 各テーブルを CSV としてインポート／エクスポート。Gist を使ったバックアップ・復元にも対応。

技術スタック
-------------

- React 18 + Vite 5
- Dexie 3（IndexedDB ラッパー）
- Netlify/Vercel 等の静的ホスティングでそのままデプロイ可能

セットアップ
------------

1. **前提条件**
   - Node.js 18 以上
   - npm（Node に同梱）

2. **依存関係のインストール**

   ```bash
   npm install
   ```

3. **開発サーバーを起動**

   ```bash
   npm run dev
   ```

   デフォルトで <http://localhost:5173> が開きます。ブラウザの IndexedDB に保存されるため、リロードしてもデータは保持されます。

4. **本番ビルド**

   ```bash
   npm run build
   ```

   `dist/` に静的ファイルが生成されます。任意の静的ホスティングへデプロイしてください。

データストレージ
----------------

- 初回起動時に `db.js` の `initSampleDataIfEmpty` がサンプル部品・製品・レシピを投入します。
- すべてのデータはブラウザの IndexedDB（データベース名: `kittingflow_local`）に保存されます。
- `parts`, `products`, `recipes`, `progress`, `savedState` の5テーブルを利用します。
- localStorage はサマリ画面の UI 状態保持に使用しています。

主要ディレクトリ
----------------

| パス | 説明 |
| ---- | ---- |
| `src/` | React アプリ本体 |
| `src/components/` | 画面コンポーネント（ピッキング、部品一覧、レシピ一覧、進捗、CSV連携など） |
| `src/styles/buttons.js` | ボタンスタイルとホバー制御 |
| `src/db.js` | Dexie 初期化と各種ヘルパー |

CSV / Gist 連携
---------------

- **CSV インポート**: Import/Export 画面から `Parts`, `Products`, `Recipe`, `Progress` の CSV を読み込みます。既存データはクリアされるため注意してください。
- **CSV エクスポート**: 現在のテーブルを Download。バックアップや Excel での編集に便利です。
- **GitHub Gist**: Personal Access Token（repo or gist 権限）を用意すると、単一の Gist ファイルとしてエクスポート／インポートできます。

よくある操作
------------

- **部品IDを変更したい**: 部品一覧で ID セルを書き換えます。レシピの参照も自動更新されます。
- **在庫数を調整したい**: 部品一覧で在庫セルを編集。ピッキング操作でも自動的に減算されます。
- **製品テンプレートを追加したい**: `Import/Export > Products.csv` を編集するか、Dexie Browser Extensions 等で直接追加します。
- **必要数量を再計算したい**: 必要数量サマリで製品と数量を選び「集計する」をクリック。結果は自動保存されます。

トラブルシューティング
----------------------

- **データが初期化された**: ブラウザのストレージを消去した／別ブラウザを使用した可能性があります。必要に応じて CSV や Gist から復元してください。
- **在庫がマイナスになる**: ピッキング時に stock を減算するだけで制限はありません。必要に応じて在庫セルを手動で調整してください。
- **部品ID変更時にエラーが出る**: 既に存在する ID へ変更しようとすると重複エラーになります。別の ID を指定するか既存行を削除してから追加してください。