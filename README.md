KittingFlow
===========

軽量なピッキング支援ツールです。React + Vite で構築され、ブラウザ内の IndexedDB（Dexie）にデータを保存します。部品・レシピ・在庫進捗をセル編集しながら、ピッキング作業や CSV / GitHub Gist 連携を行えます。

主な機能
--------

- **ピッキング画面**: 製品テンプレートに従って部品を順番に表示し、作業完了時に在庫を自動減算。
- **部品一覧（セル編集）**: ID・名称・在庫・画像 URL を直接編集。Enter / 矢印キーでセル移動が可能で、ID 変更時は紐づくレシピも追随します。
- **レシピ一覧（セル編集）**: 製品 ID / 名称や部品 ID / 名称、必要数を直接編集。部品 ID を入力すると名称を自動補完します。
- **必要数量サマリ**: 複数製品の要求数を合算し、不足数を試算。直近の選択と結果は localStorage に保持されます。
- **進捗管理**: 製品ごとの現在位置を一覧し、リセット操作や QR ラベル出力が可能。
- **CSV / GitHub Gist 連携**: テーブル内容を CSV として入出力。Gist をバックアップ先として利用できます。

技術スタック
------------

- React 18 + Vite 5
- Dexie 3（IndexedDB ラッパー）
- 任意の静的ホスティングサービスでデプロイ可能

セットアップ
------------

1. **前提条件**
   - Node.js 18 以上
   - npm（Node.js に同梱）

2. **依存関係のインストール**

   ```bash
   npm install
   ```

3. **開発サーバーの起動**

   ```bash
   npm run dev
   ```

   <http://localhost:5173> が開きます。ブラウザの IndexedDB に保存されるため、リロードしてもデータは保持されます。

4. **本番ビルド**

   ```bash
   npm run build
   ```

   `dist/` に静的ファイルが生成されます。任意の静的ホスティングへ配置してください。

データストレージ
----------------

- 初回起動時に `db.js` の `initSampleDataIfEmpty` がサンプル部品・製品・レシピを投入します。
- すべてのデータはブラウザの IndexedDB（データベース名: `kittingflow_local`）に保存されます。
- `parts`, `products`, `recipes`, `progress`, `savedState` の 5 テーブルを使用します。
- localStorage は必要数量サマリ画面の UI 状態保持に利用しています。

主要ディレクトリ
----------------

| パス | 説明 |
| ---- | ---- |
| `src/` | React アプリ本体 |
| `src/components/` | 画面コンポーネント（ピッキング、部品一覧、レシピ一覧、進捗、CSV 連携など） |
| `src/styles/buttons.js` | ボタンスタイルとホバー制御 |
| `src/styles/theme.js` | カラーパレットや余白など共通テーマ定義 |
| `src/db.js` | Dexie 初期化とデータヘルパー |

CSV / Gist 連携
---------------

- **CSV インポート**: Import/Export 画面から `Parts`, `Products`, `Recipe`, `Progress` の CSV を読み込みます（既存データは消去されます）。
- **CSV エクスポート**: 現在のテーブルを一括で CSV ダウンロードできます。
- **GitHub Gist**: Personal Access Token（repo または gist 権限）を用意すると、Gist へのバックアップ / 復元が可能です。

よくある操作
------------

- **部品 ID を変更したい**: 部品一覧で ID セルを書き換えると、レシピの参照も自動更新されます。
- **在庫数を調整したい**: 部品一覧で在庫セルを更新できます。ピッキング操作でも数が減算されます。
- **製品テンプレートを追加したい**: `Import/Export > Products.csv` を編集するか、Dexie Browser Extensions などで直接追加します。
- **必要数量を再計算したい**: 必要数量サマリで製品と数量を選び「集計する」を押すと結果が再計算され、状態も保存されます。

トラブルシューティング
----------------------

- **データが初期化された**: ブラウザのストレージを削除した、または別ブラウザを使用した可能性があります。CSV や Gist バックアップから復元してください。
- **在庫がマイナスになる**: ピッキング時は在庫を自動減算するだけで制限はありません。必要に応じて在庫セルを手動で調整してください。
- **部品 ID 変更時にエラーになる**: 既に存在する ID へ変更すると重複エラーになります。別の ID を指定するか、既存行を削除してから追加してください。

ライセンス
----------

リポジトリに添付されたライセンスに従ってください。明記がない場合は内部利用前提のサンプルとして扱ってください。
